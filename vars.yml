---
# Ansible Tower Installation
#installation_tarball: https://releases.ansible.com/ansible-tower/setup-bundle/ansible-tower-setup-bundle-latest.tar.gz
installation_tarball: http://perf54.perf.lab.eng.bos.redhat.com/pub/ansible-automation-platform-setup-bundle-2.0.0-1-early-access.tar.gz

scenario: "plain-nodes"

scenario_map:
  "plain-nodes":
    plain_nodes: 2
    install_tower: False
  "custom":
    # leave everything as 0/False/defaults, user must provide all overrides
  "control-cluster":
    control_nodes: 3
    execution_nodes: 3
    inventory_template: "inventory_cluster_4.1.j2"
    install_tower: True
  "hybrid-cluster":
    hybrid_nodes: 3
    execution_nodes: 3
    inventory_template: "inventory_cluster_4.1.j2"
  "control-cluster-1-hop-to-execution-plane":
    control_nodes: 3
    execution_nodes: 2
    hop_nodes: 1
    inventory_template: "inventory_cluster_4.1.j2"
    install_tower: True
  "control-cluster-2-hop-to-execution-plane":
    control_nodes: 3
    execution_nodes: 2
    hop_nodes: 2
    inventory_template: "inventory_cluster_4.1.j2"
    install_tower: True
  "control-cluster-3-hop-to-execution-plane":
    control_nodes: 3
    execution_nodes: 2
    hop_nodes: 3
    inventory_template: "inventory_cluster_4.1.j2"
    install_tower: True
  "hybrid-cluster-hop-to-execution-plane":
    hybrid_nodes: 3
    execution_nodes: 2
    hop_nodes: 1
    inventory_template: "inventory_cluster_4.1.j2"
    install_tower: True
  "single-hybrid":
    hybrid_nodes: 1
    inventory_template: "inventory_cluster_4.1.j2"
    install_tower: True
  "legacy-38-cluster-with-isolated-nodes":
    hybrid_nodes: 3
    legacy_isolated_nodes: 2
    inventory_template: "inventory_cluster.j2"
    install_tower: True
  "legacy-38-cluster":
    hybrid_nodes: 3
    inventory_template: "inventory_cluster.j2"
    install_tower: True
  "legacy-40-cluster":
    hybrid_nodes: 3
    inventory_template: "inventory_cluster_4.j2"
    install_tower: True

plain_nodes: '{{ scenario_map[scenario]["plain_nodes"]|default(0)|int }}'
tower_control_nodes: '{{ scenario_map[scenario]["control_nodes"]|default(0)|int }}'
tower_hybrid_nodes: '{{ scenario_map[scenario]["hybrid_nodes"]|default(0)|int }}'
tower_execution_nodes: '{{ scenario_map[scenario]["execution_nodes"]|default(0)|int }}'
tower_isolated_nodes: '{{ scenario_map[scenario]["legacy_isolated_nodes"]|default(0)|int }}'
tower_hop_nodes: '{{ scenario_map[scenario]["hop_nodes"]|default(0)|int }}'
inventory_template: '{{ scenario_map[scenario]["inventory_template"]|default("") }}'
install_tower: '{{ scenario_map[scenario]["install_tower"]|default(False)|bool }}'

# Tower and the Database must be in the same Region and in the same VPC
ibmcloud_vpc_name_prefix: 'ansible-tower-test'
ibmcloud_vpc_region: 'jp-tok'    # Tokyo
ibmcloud_image: "rhel_8.3"
ibmcloud_image_ids:
  "au-syd":
    "rhel_8.3": "r026-587ff0d6-6549-44f6-a6ed-f1e11174fb43"
    "rhel_8.4": "r026-ad73645c-afe8-4b93-b4fe-dbfd1880bebd"
  "jp-osa":
    "rhel_8.3": "r034-260cc2b2-d96c-4fa1-83d5-ef7524d6c909"
    "rhel_8.4": "r034-ee558f96-4494-461c-aec6-20d2efc7df05"
  "jp-tok":
    "rhel_8.3": "r022-939bbfe2-d823-4c01-98a3-a6f8193731d8"
    "rhel_8.4": "r022-25bf2491-2911-4860-9573-bf487884f3c1"
  "eu-de":
    "rhel_8.3": "r010-5ea36559-4a3a-40e4-9222-b1d0a430951e"
    "rhel_8.4": "r010-a704b088-c2ee-4f92-b384-1a0ac30f2f19"
  "eu-gb":
    "rhel_8.3": "r018-179f9b5c-0e4d-4614-8fbb-07e8ec55a493"
    "rhel_8.4": "r018-fc0d7bfc-8fc1-4184-a9b8-5e8bcdd61c0e"
  "ca-tor":
    "rhel_8.3": "r038-ce441bef-75f6-4bca-a1b4-96ce0e9ca1e6"
    "rhel_8.4": "r038-358762fc-47c7-43f4-b2b6-2cc17e5c1f60"
  "us-south":
    "rhel_8.3": "r006-c803a85a-e3cf-4f61-bafa-ae1d9e759d15"
    "rhel_8.4": "r006-bf22526d-a650-49bb-bc6e-3275694d2b27"
  "us-east":
    "rhel_8.3": "r014-02843c52-e12b-4f72-a631-931b4bf6589d"
    "rhel_8.4": "r014-0b1d622e-19f8-4e20-aa2d-ef4256c9ee72"
  "br-sao":
    "rhel_8.3": "r042-71b7a0b1-5b3c-4024-b815-2b2d79687792"
    "rhel_8.4": "r042-06ad9b4d-02a7-44bb-989e-18f1882646ac"

ibmcloud_vsi_profile: 'bx2-4x16'
ibmcloud_vsi_count: '{{ tower_control_nodes|int + tower_hybrid_nodes|int + plain_nodes|int |int}}'
# Find the right RHEL 8.3 image for the region
# Recorded from for region in $IC_REGIONS; do ibmcloud target -r $region && ibmcloud is image ibm-redhat-8-3-minimal-amd64-3;
ibmcloud_vsi_image_id: '{{ ibmcloud_image_ids[ibmcloud_vpc_region][ibmcloud_image] }}'

# Ansible Tower and Tower database must be in the same
ibmcloud_vsi_db_profile: 'bx2-4x16'


# Isolated Nodes must be in the different region compared to Controller
ibmcloud_vpc_iso_name_prefix: 'ansible-tower-iso-test'
ibmcloud_vpc_iso_region: 'eu-gb'    # London
ibmcloud_vsi_iso_image_id: '{{ ibmcloud_image_ids[ibmcloud_vpc_iso_region][ibmcloud_image] }}'
ibmcloud_vsi_iso_profile: 'bx2-4x16'
ibmcloud_vsi_iso_instance_count: '{{ tower_isolated_nodes|int }}'
install_iso: '{{ tower_isolated_nodes|int > 0 |bool}}'


# Execution Node Variables, in Tower 4.1, execution_node is a replacement of isolated nodes

ibmcloud_vpc_execution_name_prefix: 'ansible-tower-exec-test'
ibmcloud_vpc_execution_region: 'eu-gb'    # London
ibmcloud_vsi_execution_image_id: '{{ ibmcloud_image_ids[ibmcloud_vpc_execution_region][ibmcloud_image] }}'
ibmcloud_vsi_execution_profile: 'bx2-4x16'
ibmcloud_vsi_execution_instance_count: '{{ tower_execution_nodes|int + tower_hop_nodes|int |int}}'
install_execution_node: '{{ (tower_execution_nodes|int + tower_hop_nodes|int) > 0 |bool }}'

#_NODE_VALID_TYPES = {
#    _CONTROL_PLANE: {
#        "types": frozenset(("control", "hybrid")),
#        "default_type": "hybrid",
#    },
#    _EXECUTION_PLANE: {
#        "types": frozenset(("execution", "hop")),
#        "default_type": "execution",

#receptor_workable_types:
#  - control
#  - execution
#  - hybrid

# Required ports for SSH, Tower, Exporters
list_of_ports: [22, 80, 443, 5432, 9121, 9256, 9117, 9393, 9392, 9187, 9100, 27199]
ssh_public_key: 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDlkniCZbiIhOv9RkoSE73Yg4sjRtuiuXWKHBCvhQ9BxZV33rMEGCUwYs2XT8QWbuJxBg+aXspZ1Of00lNV1S2/Ukg4n6Os7szI6mqJQgFR/oqLckGbHML76CdvwQ1iVoSFdE5bieQdfbK+LmIRVQAzO93090jWtWaJ8MkxzgarvXpPcwidVjB/PDsIq3NG/6boH/xUhxRH/Qt+4ShVH0/w4YTLGAvp56yeN+1XWoGy/D0V7JQX9y82ca3n9S+DsYAJBcUp/k7rjqtEsNBDYpNk7nvjmt9jiXCVCBu6EajcINOa/uEsWsyX/iyxE6XENsBP+hPK7/HMEqvMJw2cfJakCHCLTRpYZSOS4fursT53ZXt+UWko8S2xIqt/kkH4HSvrfHejlUWGILlRhEKX6SfMQaLLWaqz8QT9LIhEY/gRjk4wekAYWSQziaMeEcUsLVITihLKKG8qw6+ig5TOlw6LAhBJxCsKPkWLul7wAP5j6mI9/M73nX8JXX3O/drcNR0= pok@localhost.localdomain'
ibmcloud_ssh_key: perfscale-automation-controller-ssh-key
